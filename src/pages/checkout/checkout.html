<ion-header>
  <main-toolbar [showCartIcon] = "false"></main-toolbar>
</ion-header>
<ion-content class="f-size-larger">
  <ion-grid>

    <ion-row *ngIf="dataLoaded">
      <ion-col class="f-padding-lr-5">
        <button class="f-btn-action" ion-button block
                [attr.disabled]="!validatePage().isValid?'':null"
                (click)="onPlaceOrderClick()"><span loc="Разместить заказ" name="PlaceYourOrder">{{locale['PlaceYourOrder']}}</span></button>
      </ion-col>
    </ion-row>

<!--
    SUMMARY AREA
-->
    <ion-row>
      <ion-col class="f-page-header"><span loc="Итог заказа" name="OrderSummary">{{locale['OrderSummary']}}</span>
      </ion-col>
    </ion-row>


    <ion-row class="f-padding-lr-5" >
      <ion-grid class="f-grid-error-border-red" *ngIf="!validatePage().isValid">
        <ion-row>
          <ion-col>
            <span loc="Ваш заказ содержит ошибки. Пожалуйста, ознакомьтесь с деталями заказа ниже" name="OrderContainsErrors">{{locale['OrderContainsErrors']}}</span>
          </ion-col>
        </ion-row>
      </ion-grid>
      <grid-hr></grid-hr>
      <ion-grid class="f-border-ligthgray" *ngIf="dataLoaded">
        <ion-row>
          <ion-col>
            <span loc="Доставка на" name="ShippingTo">{{locale['ShippingTo']}}</span>:
            <b>{{cart.order?.clientaddress?.recName}}</b>, {{cart.order?.clientaddress?.addressString}}
            <hr>
          </ion-col>
        </ion-row>

        <ion-row>
          <ion-col>
            <span loc="Товары" name="Items">{{locale['Items']}}</span> ({{cart.cartItemsCount}}):
          </ion-col>
          <ion-col text-right col-auto>
            {{cart.itemsTotal | localeCurrency:userService.currency}}
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col>
            <span loc="Доставка" name="Shipping">{{locale['Shipping']}}</span>:
          </ion-col>
          <ion-col text-right col-auto>
            {{cart.shippingCost | localeCurrency:userService.currency}}
          </ion-col>
        </ion-row>

        <ion-row>
          <ion-col>
            <span loc="Сумма заказа" name="OrderTotal">{{locale['OrderTotal']}}</span>:
          </ion-col>
          <ion-col text-right col-auto>
            <span class="f-color-red">{{cart.orderTotal | localeCurrency:userService.currency}}</span>
          </ion-col>
        </ion-row>


        <ion-row *ngIf="(cart.promoCodeDiscount>0)">
          <ion-col>
            <span loc="Скидка промокода" name="PromocodeDiscount">{{locale['PromocodeDiscount']}}</span>:
          </ion-col>
          <ion-col text-right col-auto>
            - {{cart.promoCodeDiscount | localeCurrency:userService.currency}}
          </ion-col>
        </ion-row>


        <ion-row *ngIf="(cart.itemsBonusDisc>0)">
          <ion-col>
            <span loc="Бонусы" name="Bonuses">{{locale['Bonuses']}}</span>:
          </ion-col>
          <ion-col text-right col-auto>
            - {{cart.itemsBonusDisc | localeCurrency:userService.currency}}
          </ion-col>
        </ion-row>

        <ion-row *ngIf="cart.payByPromoBonus && (!(cart.availBonus === 0))">
          <ion-col>
            <span loc="Акционные бонусы" name="PromoBonuses">{{locale['PromoBonuses']}}</span>:
          </ion-col>
          <ion-col text-right col-auto>
            - {{cart.itemsPromoBonusDisc | localeCurrency:userService.currency}}
          </ion-col>
        </ion-row>

        <ion-row>
          <ion-col>
            <b><span loc="Окончательная стоимость" name="GrandTotal">{{locale['GrandTotal']}}</span>:</b>
          </ion-col>
          <ion-col text-right col-auto>
            <span class="f-color-red"><b>{{cart.cartGrandTotal | localeCurrency:userService.currency}}</b></span>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-row>

<!--
    PAYMENT INFO AREA
-->

    <ion-row>
      <ion-col class="f-section-header"><b><span loc="Информация об оплате" name="PaymentInfo">{{locale['PaymentInfo']}}</span></b>
      </ion-col>
    </ion-row>

    <ion-row class="f-padding-lr-5">
      <ion-grid class="f-border-ligthgray" *ngIf="dataLoaded">
        <ion-row>
          <ion-col>
            <b><span loc="Способ оплаты" name="PaymentMethod">{{locale['PaymentMethod']}}</span></b>
            <br>
            {{ cart.pmtMethod.name }}
          </ion-col>
        </ion-row>
        <div *ngIf="cart.loan && (cart.pmtMethod.id === 3)">
          <hr>
          <credit-brief [creditAmt]="cart.cartGrandTotal" [credit]="cart.loan"></credit-brief>
        </div>
      </ion-grid>
    </ion-row>

    <promo-code *ngIf="dataLoaded"></promo-code>

<!--
   SHIPPING ITEMS AREA
-->
    <div *ngFor="let item of cart.orderProducts; let i = index">
      <ion-row>
        <ion-col class="f-section-header">
          <b><span loc="Доставка" name="Shipment">{{locale['Shipment']}}</span> {{i+1}} <span loc="из" name="Of">{{locale['Of']}}</span> {{cart.orderProducts.length}}</b>
          <br>
          <span class="f-size-default"><span loc="Товар поставляется" name="ItemShippedFrom">{{locale['ItemShippedFrom']}}</span> {{item?.quotationproduct?.quotation?.supplier?.name}}</span>
        </ion-col>
      </ion-row>

<!--
      <ion-row>
        <ion-col style="padding-left: 15px; padding-right: 15px; padding-top: 20px;">
          <b>Shipment {{i+1}} of {{cart.orderProducts.length}}</b>
          <br>
          Item shipped from {{item?.quotationproduct?.quotation?.supplier?.name}}
        </ion-col>
      </ion-row>
-->

      <ion-row class="f-padding-lr-5">
        <ion-grid class="f-border-ligthgray" *ngIf="dataLoaded">
          <ion-row>
            <ion-col>
              {{cart.loResultDeliveryOptions[i].loName}}
              <hr>
            </ion-col>
          </ion-row>

          <ion-row *ngIf="item.idStorePlace">
            <ion-col>
              <span loc="Получение в" name="PickupAt">{{locale['PickupAt']}}</span> --
              <span class="f-color-green">{{item?.storeplace?.name}}, {{item?.storeplace?.address_line}}
                {{item?.storeplace?.city?.name}}</span>
              <hr>
            </ion-col>
          </ion-row>

          <ion-row>
            <ion-col>
              <span loc="Предполагаемая дата доставки" name="EstDeliveryDate">{{locale['EstDeliveryDate']}}</span> --
              <span class="f-color-green">{{cart.loResultDeliveryOptions[i].deliveryDate | date: 'fullDate'}}</span>
              <hr>
            </ion-col>
          </ion-row>

          <ion-row>
            <ion-col col-auto>
              <div>
                <img *ngIf="item?.quotationproduct?.product?.imageUrl" class="f-img-item-80"
                     [src]="item?.quotationproduct?.product?.imageUrl">
                <img *ngIf="!item?.quotationproduct?.product?.imageUrl" class="f-img-item-80"
                     src="assets/imgs/nophoto.png">

              </div>
            </ion-col>
            <ion-col no-padding>
              <ion-grid class="f-item-nopadding-tb">
                <ion-row>
                  <ion-col>
                    <span><b>{{item?.quotationproduct?.product.name}}</b></span>
                  </ion-col>
                </ion-row>

                <ion-row>
                  <ion-col class="f-item-padding-bottom">
                    <span class="f-color-red">{{item?.price |  localeCurrency:userService.currency}}</span>
                  </ion-col>
                </ion-row>

                <ion-row *ngIf="item?.quotationproduct?.product?.bonuses">
                  <ion-col class="f-item-padding-bottom" >
                    <bonus [bonusCnt]="item?.quotationproduct?.product?.bonuses"></bonus>
                  </ion-col>
                </ion-row>


                <ion-row *ngIf="item.errorMessage">
                  <ion-col class="f-size-small">
                    <error [errorText]="item?.errorMessage"></error>
<!--
                    <span class="f-size-small f-color-red">{{item?.errorMessage}}</span>
-->
                  </ion-col>
                </ion-row>

              </ion-grid>


            </ion-col>

          </ion-row>
          <ion-row>
            <ion-col class="f-item-padding-bottom">
              <dropdown-list id="btnQty" [reference]="item"
                             [afterUpdate] = "onAfterQtyUpdate"
                             [map]="{valueName:'qty', displayName:'qty'}"
                             [options]="{popupHeader:locale['Quantity'], buttonHeader:locale['Qty'], buttonClass:'f-drop-button-block'}"
                             [isQty]="true">
              </dropdown-list>
            </ion-col>
          </ion-row>


        </ion-grid>
      </ion-row>

    </div>

    <ion-row *ngIf="dataLoaded">
      <ion-col class="f-padding-lr-5">
        <button class="f-btn-action" ion-button block
                [attr.disabled]="!validatePage().isValid?'':null"
                (click)="onPlaceOrderClick()"><span loc="Разместить заказ" name="PlaceYourOrder">{{locale['PlaceYourOrder']}}</span></button>
      </ion-col>
    </ion-row>

  </ion-grid>
</ion-content>
